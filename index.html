<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>理財計算機</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; margin: 0; padding: 0; }
        .nav { display: flex; background: #2c3e50; justify-content: center; }
        .nav button { color: white; border: none; padding: 15px; background: none; cursor: pointer; font-size: 16px; opacity: 0.7; }
        .nav button.active { opacity: 1; border-bottom: 3px solid #f1c40f; }
        .tab { display: none; padding: 20px; max-width: 900px; margin: auto; }
        .tab.active { display: block; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button.run { width: 100%; padding: 15px; background: #2c3e50; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .res { margin-top: 15px; padding: 15px; border-radius: 8px; color: white; text-align: center; }
        #chart-wrap { height: 300px; }
    </style>
</head>
<body>

<div class="nav">
    <button onclick="sw('ret')" id="b1" class="active">退休試算</button>
    <button onclick="sw('inf')" id="b2">通膨換算</button>
</div>

<div id="ret" class="tab active">
    <div class="card">
        <label>初始本金(萬)</label><input type="number" id="p" value="100">
        <label>每月存入(元)</label><input type="number" id="m" value="10000">
        <label>報酬率(%)</label><input type="number" id="r" value="8">
        <label>年期</label><input type="number" id="y" value="30">
        <label>通膨率(%)</label><input type="number" id="i" value="3">
        <button class="run" onclick="calR()">開始試算</button>
    </div>
    <div class="res" style="background:#3498db;">總額：<span id="out">0</span></div>
    <div class="card" id="chart-wrap"><canvas id="myChart"></canvas></div>
</div>

<div id="inf" class="tab">
    <div class="card">
        <label>現在年齡</label><input type="number" id="ca" value="35">
        <label>退休年齡</label><input type="number" id="ra" value="65">
        <label>每月生活費</label><input type="number" id="fv" value="50000">
        <button class="run" style="background:#27ae60;" onclick="calI()">計算購買力</button>
    </div>
    <div class="res" id="ires" style="background:#27ae60; display:none;">
        現在購買力：<span id="pv">0</span>
    </div>
</div>

<script>
    let chart = null;
    function sw(t) {
        document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
        document.querySelectorAll('.nav button').forEach(x => x.classList.remove('active'));
        document.getElementById(t).classList.add('active');
        event.target.classList.add('active');
    }

    function calR() {
        let p = (Number(document.getElementById('p').value)||0)*10000;
        let m = Number(document.getElementById('m').value)||0;
        let r = (Number(document.getElementById('r').value)||0)/100;
        let y = Number(document.getElementById('y').value)||0;
        let i = (Number(document.getElementById('i').value)||0)/100;
        
        let a = p, lbs = ['起始'], d = [Math.round(a)];
        for(let k=1; k<=y; k++) {
            a = (a + m*12) * (1+r);
            lbs.push('第'+k+'年'); d.push(Math.round(a));
        }
        document.getElementById('out').innerText = '$' + Math.round(a).toLocaleString();
        
        const ctx = document.getElementById('myChart').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'line',
            data: { labels: lbs, datasets: [{ label: '資產', data: d, borderColor: '#3498db', fill: true }] },
            options: { responsive: true, maintainAspectRatio: false }
        });
    }

    function calI() {
        let n = Number(document.getElementById('ra').value) - Number(document.getElementById('ca').value);
        let f = Number(document.getElementById('fv').value);
        let r = 0.03; 
        let p = f / Math.pow(1+r, n);
        document.getElementById('pv').innerText = '$' + Math.round(p).toLocaleString();
        document.getElementById('ires').style.display = 'block';
    }
    window.onload = calR;
</script>
</body>
</html>
